<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La soirée - Snake</title>
  <link rel="stylesheet" href="style.css">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 30px;
    }

    canvas {
      background: #222;
      border: 3px solid #0f0;
      touch-action: none;
      display: block;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #0f0;
      color: #000;
      font-weight: bold;
    }

    button:hover {
      background: #3f3;
    }

    nav.horizontal {
      width: 100%;
      background: #111;
      padding: 5px 0;
      display: flex;
      justify-content: center;
    }

    nav.horizontal .menu-items a {
      color: #0f0;
      margin: 0 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
    }

    nav.horizontal .menu-items a.active {
      text-decoration: underline;
    }
  </style>
</head>

<body>

  <nav class="horizontal">
    <div class="menu-items">
      <a href="index.html">Accueil</a>
      <a href="equipes.html">Équipes</a>
      <a href="soiree.html" class="active">La soirée</a>
      <a href="resultat.html">Résultats</a>
    </div>
  </nav>

  <div id="game-container">
    <canvas id="game"></canvas>

    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="pauseBtn">Pause</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* CANVAS RESPONSIVE */
function resizeCanvas() {
  const size = Math.min(window.innerWidth - 20, 350);
  canvas.width = size;
  canvas.height = size;
}
resizeCanvas();

/* VARIABLES JEU */
let player, obstacles, score, gravity;
let gameLoop = null;
let gameRunning = false;
let obstacleInterval;

/* INIT JEU */
function initGame() {
  player = {
    x: canvas.width / 4,
    y: canvas.height - 20,
    width: 20,
    height: 20,
    vy: 0,
    gravity: 0.5,
    flipped: false
  };

  obstacles = [];
  score = 0;
  gravity = 0.5;
}

/* CRÉATION OBSTACLE */
function createObstacle() {
  const height = 30 + Math.random() * (canvas.height / 2);
  const gap = 40; // passage
  const flip = Math.random() > 0.5; // top ou bottom

  obstacles.push({
    x: canvas.width,
    width: 20,
    top: flip ? 0 : canvas.height - height,
    height: height,
    gap: gap,
    passed: false,
    flip: flip
  });
}

/* DESSIN */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  player.vy += player.flipped ? -gravity : gravity;
  player.y += player.vy;

  ctx.fillStyle = "yellow";
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // Obstacles
  ctx.fillStyle = "#0f0";
  obstacles.forEach(obs => {
    obs.x -= 2;
    if (obs.flip) {
      // Top obstacle
      ctx.fillRect(obs.x, 0, obs.width, obs.height);
      ctx.fillRect(obs.x, obs.height + obs.gap, obs.width, canvas.height - obs.height - obs.gap);
    } else {
      // Bottom obstacle
      ctx.fillRect(obs.x, 0, obs.width, canvas.height - obs.height - obs.gap);
      ctx.fillRect(obs.x, canvas.height - obs.height, obs.width, obs.height);
    }

    // Collision
    if (
      player.x + player.width > obs.x &&
      player.x < obs.x + obs.width &&
      (player.y < obs.height || player.y + player.height > canvas.height - obs.height)
    ) {
      gameOver();
    }

    // Score
    if (!obs.passed && obs.x + obs.width < player.x) {
      score++;
      obs.passed = true;
    }
  });

  // Retirer obstacles hors écran
  obstacles = obstacles.filter(obs => obs.x + obs.width > 0);

  // Limites
  if (player.y < 0 || player.y + player.height > canvas.height) {
    gameOver();
  }

  // Score affichage
  ctx.fillStyle = "#fff";
  ctx.font = "16px Arial";
  ctx.fillText("Score : " + score, 10, 20);
}

/* LOOP */
function loop() {
  draw();
}

/* GRAVITY FLIP */
function flipGravity() {
  if (gameRunning) {
    player.flipped = !player.flipped;
    player.vy = 0; // reset vitesse verticale pour mieux contrôler
  }
}

/* GAME OVER */
function gameOver() {
  stopGame();
  alert("Game Over ! Score : " + score);
  document.location.reload();
}

/* START / STOP */
function startGame() {
  if (!gameRunning) {
    initGame();
    gameRunning = true;
    gameLoop = setInterval(loop, 16);
    obstacleInterval = setInterval(createObstacle, 1500);
  }
}

function stopGame() {
  clearInterval(gameLoop);
  clearInterval(obstacleInterval);
  gameRunning = false;
}

/* CONTROLES CLAVIER */
document.addEventListener("keydown", e => {
  if (e.code === "Space" || e.code === "Enter") {
    if (!gameRunning) startGame();
    flipGravity();
  }
});

/* TOUCH / CLICK */
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  if (!gameRunning) startGame();
  flipGravity();
});
canvas.addEventListener("mousedown", () => {
  if (!gameRunning) startGame();
  flipGravity();
});

/* BUTTONS */
document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("pauseBtn").addEventListener("click", stopGame);

/* RESIZE */
window.addEventListener("resize", resizeCanvas);
</script>

</body>
</html>
